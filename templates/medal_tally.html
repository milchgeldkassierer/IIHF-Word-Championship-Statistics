{% extends "base.html" %}

{% block title %}Medaillenspiegel - IIHF WM Tracker{% endblock %}

{% block head_scripts %}
<style>
    .stats-section {
        background-color: #fff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: box-shadow 0.3s ease;
    }
    
    .stats-section:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .stats-title {
        color: #495057;
        border-bottom: 2px solid #6c757d;
        padding-bottom: 10px;
        margin-bottom: 20px;
        font-weight: 600;
    }
    
    /* Dark mode improvements */
    body.dark-mode .stats-section {
        background-color: #2d3748;
        border-color: #4a5568;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    body.dark-mode .stats-section:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    
    body.dark-mode .stats-title {
        color: #e2e8f0;
        border-bottom-color: #a0aec0;
    }
    
    body.dark-mode .table {
        background-color: #2d3748;
        color: #e2e8f0;
    }
    
    body.dark-mode .table th,
    body.dark-mode .table td {
        border-color: #4a5568;
        color: #e2e8f0;
        background-color: transparent;
    }
    
    body.dark-mode .table .thead-dark th {
        background-color: #1a202c;
        border-color: #2d3748;
        color: #e2e8f0;
        font-weight: 600;
    }
    
    body.dark-mode .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(255, 255, 255, 0.08) !important;
    }
    
    body.dark-mode .table-striped tbody tr:nth-of-type(even) {
        background-color: rgba(255, 255, 255, 0.03) !important;
    }
    
    body.dark-mode .table-hover tbody tr:hover {
        background-color: rgba(66, 153, 225, 0.15) !important;
    }
    
    body.dark-mode .table-responsive {
        border: 1px solid #4a5568;
        border-radius: 8px;
        background-color: #2d3748;
    }
    
    body.dark-mode .badge.bg-warning {
        background-color: #ffd700 !important;
        color: #1a202c !important;
        font-weight: bold;
    }
    
    body.dark-mode .badge.bg-secondary {
        background-color: #c0c0c0 !important;
        color: #1a202c !important;
        font-weight: bold;
    }
    
    body.dark-mode .badge.bg-dark {
        background-color: #cd7f32 !important;
        color: #ffffff !important;
        font-weight: bold;
    }
    
    body.dark-mode .badge.bg-info {
        background-color: #4299e1 !important;
        color: #1a202c !important;
        font-weight: bold;
    }
    
    body.dark-mode .text-muted {
        color: #a0aec0 !important;
    }
    
    body.dark-mode td strong {
        color: #ffffff;
        font-weight: 700;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Medaillenspiegel</h1>

    <div class="stats-section">
        <h3 class="stats-title">Medaillen nach Jahr</h3>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Jahr</th>
                        <th>Gold</th>
                        <th>Silber</th>
                        <th>Bronze</th>
                        <th>4. Platz</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medal_entry in medal_data | sort(attribute='year_obj.year') %}
                    <tr>
                        <td>{{ medal_entry.year_obj.year }}</td>
                        <td>
                            {% if medal_entry.gold %}
                                {% set team_code = medal_entry.gold %}
                                {% if team_iso_codes.get(team_code) %}
                                    <img src="https://flagcdn.com/w20/{{ team_iso_codes[team_code] }}.png" alt="{{ team_code }}"> 
                                {% endif %}
                                {{ team_code }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if medal_entry.silver %}
                                {% set team_code = medal_entry.silver %}
                                {% if team_iso_codes.get(team_code) %}
                                    <img src="https://flagcdn.com/w20/{{ team_iso_codes[team_code] }}.png" alt="{{ team_code }}"> 
                                {% endif %}
                                {{ team_code }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if medal_entry.bronze %}
                                {% set team_code = medal_entry.bronze %}
                                {% if team_iso_codes.get(team_code) %}
                                    <img src="https://flagcdn.com/w20/{{ team_iso_codes[team_code] }}.png" alt="{{ team_code }}"> 
                                {% endif %}
                                {{ team_code }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if medal_entry.fourth %}
                                {% set team_code = medal_entry.fourth %}
                                {% if team_iso_codes.get(team_code) %}
                                    <img src="https://flagcdn.com/w20/{{ team_iso_codes[team_code] }}.png" alt="{{ team_code }}"> 
                                {% endif %}
                                {{ team_code }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center">Keine Medaillendaten verfÃ¼gbar.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Medal Count Summary -->
    <div class="stats-section">
        <h3 class="stats-title">Medaillenspiegel Zusammenfassung</h3>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Team</th>
                        <th class="text-center">ðŸ¥‡ Gold</th>
                        <th class="text-center">ðŸ¥ˆ Silber</th>
                        <th class="text-center">ðŸ¥‰ Bronze</th>
                        <th class="text-center">4. Platz</th>
                        <th class="text-center">Gesamt</th>
                    </tr>
                </thead>
                <tbody>
                    {% set medal_counts = {} %}
                    {% for medal_entry in medal_data %}
                        {% if medal_entry.gold %}
                            {% set _ = medal_counts.setdefault(medal_entry.gold, {'gold': 0, 'silver': 0, 'bronze': 0, 'fourth': 0}) %}
                            {% set _ = medal_counts[medal_entry.gold].update({'gold': medal_counts[medal_entry.gold]['gold'] + 1}) %}
                        {% endif %}
                        {% if medal_entry.silver %}
                            {% set _ = medal_counts.setdefault(medal_entry.silver, {'gold': 0, 'silver': 0, 'bronze': 0, 'fourth': 0}) %}
                            {% set _ = medal_counts[medal_entry.silver].update({'silver': medal_counts[medal_entry.silver]['silver'] + 1}) %}
                        {% endif %}
                        {% if medal_entry.bronze %}
                            {% set _ = medal_counts.setdefault(medal_entry.bronze, {'gold': 0, 'silver': 0, 'bronze': 0, 'fourth': 0}) %}
                            {% set _ = medal_counts[medal_entry.bronze].update({'bronze': medal_counts[medal_entry.bronze]['bronze'] + 1}) %}
                        {% endif %}
                        {% if medal_entry.fourth %}
                            {% set _ = medal_counts.setdefault(medal_entry.fourth, {'gold': 0, 'silver': 0, 'bronze': 0, 'fourth': 0}) %}
                            {% set _ = medal_counts[medal_entry.fourth].update({'fourth': medal_counts[medal_entry.fourth]['fourth'] + 1}) %}
                        {% endif %}
                    {% endfor %}

                    {% for team_code, counts in medal_counts.items() | sort(attribute='1.gold', reverse=true) %}
                        {% set total = counts.gold + counts.silver + counts.bronze + counts.fourth %}
                        {% if total > 0 %}
                        <tr>
                            <td>
                                {% if team_iso_codes.get(team_code) %}
                                    <img src="https://flagcdn.com/w20/{{ team_iso_codes[team_code] }}.png" alt="{{ team_code }}" class="me-2"> 
                                {% endif %}
                                <strong>{{ team_code }}</strong>
                            </td>
                            <td class="text-center">
                                {% if counts.gold > 0 %}
                                    <span class="badge bg-warning text-dark fs-5 px-3 py-2" style="font-weight: bold;">{{ counts.gold }}</span>
                                {% else %}
                                    <span class="text-muted fs-5">-</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if counts.silver > 0 %}
                                    <span class="badge bg-secondary text-white fs-5 px-3 py-2" style="font-weight: bold;">{{ counts.silver }}</span>
                                {% else %}
                                    <span class="text-muted fs-5">-</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if counts.bronze > 0 %}
                                    <span class="badge bg-dark text-white fs-5 px-3 py-2" style="font-weight: bold;">{{ counts.bronze }}</span>
                                {% else %}
                                    <span class="text-muted fs-5">-</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if counts.fourth > 0 %}
                                    <span class="badge bg-info text-dark fs-5 px-3 py-2" style="font-weight: bold;">{{ counts.fourth }}</span>
                                {% else %}
                                    <span class="text-muted fs-5">-</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <strong class="fs-4">{{ total }}</strong>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
